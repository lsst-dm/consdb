"""Add column scheduler_note

Revision ID: 8a5f60cba278
Revises: e65e9e2237ba
Create Date: 2025-05-13 16:23:59.050127+00:00

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision: str = "8a5f60cba278"
down_revision: Union[str, None] = "e65e9e2237ba"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_unique_constraint(
        "un_ccdexposure_ccdexposure_id", "ccdexposure", ["ccdexposure_id"], schema="cdb_lsstcam"
    )
    op.create_table_comment(
        "ccdexposure",
        "Information from observatory systems about each detector (CCD) within each raw image taken",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.create_table_comment(
        "ccdexposure_camera",
        "Information from the Camera Control System about each detector (CCD) within each raw image taken",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.create_table_comment(
        "ccdexposure_flexdata",
        "Flexible key/value metadata about each detector (CCD) within each raw image taken; used for development and engineering purposes",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.create_table_comment(
        "ccdexposure_flexdata_schema",
        "Key names and value types used in the ccdexposure_flexdata table",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.create_table_comment(
        "ccdexposure_quicklook",
        "Information from Summit Rapid Analysis about each detector (CCD) within each raw image taken",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.create_table_comment(
        "ccdvisit1_quicklook",
        "Information from Summit Rapid Analysis about each detector (CCD) within each visit in visit system 1 (visit per exposure); describes detectors in processed visit images (or calibrated exposures)",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.add_column(
        "exposure",
        sa.Column(
            "scheduler_note",
            sa.VARCHAR(length=1024)
            .with_variant(mysql.VARCHAR(length=1024), "mysql")
            .with_variant(sa.VARCHAR(length=1024), "postgresql"),
            nullable=True,
            comment="A note indicating how or why the observation was chosen by the Feature Based Scheduler.",
        ),
        schema="cdb_lsstcam",
    )
    op.create_unique_constraint(
        "un_exposure_day_obs_seq_num", "exposure", ["day_obs", "seq_num"], schema="cdb_lsstcam"
    )
    op.create_table_comment(
        "exposure",
        "Information from observatory systems about each raw image taken",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.create_unique_constraint(
        "un_exposure_flexdata_day_obs_seq_num_key",
        "exposure_flexdata",
        ["day_obs", "seq_num", "key"],
        schema="cdb_lsstcam",
    )
    op.create_table_comment(
        "exposure_flexdata",
        "Flexible key/value metadata about each raw image taken; used for development and engineering purposes",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.create_table_comment(
        "exposure_flexdata_schema",
        "Key names and value types used in the exposure_flexdata table",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.create_table_comment(
        "exposure_quicklook",
        "Information from Summit Rapid Analysis about each raw image taken",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    op.create_table_comment(
        "visit1_quicklook",
        "Information from Summit Rapid Analysis about each visit in visit system 1 (visit per exposure); describes processed visit images (or calibrated exposures)",
        existing_comment=None,
        schema="cdb_lsstcam",
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table_comment(
        "visit1_quicklook",
        existing_comment="Information from Summit Rapid Analysis about each visit in visit system 1 (visit per exposure); describes processed visit images (or calibrated exposures)",
        schema="cdb_lsstcam",
    )
    op.drop_table_comment(
        "exposure_quicklook",
        existing_comment="Information from Summit Rapid Analysis about each raw image taken",
        schema="cdb_lsstcam",
    )
    op.drop_table_comment(
        "exposure_flexdata_schema",
        existing_comment="Key names and value types used in the exposure_flexdata table",
        schema="cdb_lsstcam",
    )
    op.drop_table_comment(
        "exposure_flexdata",
        existing_comment="Flexible key/value metadata about each raw image taken; used for development and engineering purposes",
        schema="cdb_lsstcam",
    )
    op.drop_constraint(
        "un_exposure_flexdata_day_obs_seq_num_key", "exposure_flexdata", schema="cdb_lsstcam", type_="unique"
    )
    op.drop_table_comment(
        "exposure",
        existing_comment="Information from observatory systems about each raw image taken",
        schema="cdb_lsstcam",
    )
    op.drop_constraint("un_exposure_day_obs_seq_num", "exposure", schema="cdb_lsstcam", type_="unique")
    op.drop_column("exposure", "scheduler_note", schema="cdb_lsstcam")
    op.drop_table_comment(
        "ccdvisit1_quicklook",
        existing_comment="Information from Summit Rapid Analysis about each detector (CCD) within each visit in visit system 1 (visit per exposure); describes detectors in processed visit images (or calibrated exposures)",
        schema="cdb_lsstcam",
    )
    op.drop_table_comment(
        "ccdexposure_quicklook",
        existing_comment="Information from Summit Rapid Analysis about each detector (CCD) within each raw image taken",
        schema="cdb_lsstcam",
    )
    op.drop_table_comment(
        "ccdexposure_flexdata_schema",
        existing_comment="Key names and value types used in the ccdexposure_flexdata table",
        schema="cdb_lsstcam",
    )
    op.drop_table_comment(
        "ccdexposure_flexdata",
        existing_comment="Flexible key/value metadata about each detector (CCD) within each raw image taken; used for development and engineering purposes",
        schema="cdb_lsstcam",
    )
    op.drop_table_comment(
        "ccdexposure_camera",
        existing_comment="Information from the Camera Control System about each detector (CCD) within each raw image taken",
        schema="cdb_lsstcam",
    )
    op.drop_table_comment(
        "ccdexposure",
        existing_comment="Information from observatory systems about each detector (CCD) within each raw image taken",
        schema="cdb_lsstcam",
    )
    op.drop_constraint("un_ccdexposure_ccdexposure_id", "ccdexposure", schema="cdb_lsstcam", type_="unique")
    # ### end Alembic commands ###
