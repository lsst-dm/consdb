"""Adjust new guider columns in visit1_quicklook

Revision ID: a322490c4e0f
Revises: 5f56db876c2b
Create Date: 2025-11-28 20:23:12.438672+00:00

"""

from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import mysql

# revision identifiers, used by Alembic.
revision: str = "a322490c4e0f"
down_revision: Union[str, None] = "5f56db876c2b"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column(
        "visit1_quicklook",
        sa.Column(
            "guider_stamp_exp_time",
            sa.FLOAT().with_variant(mysql.FLOAT(), "mysql").with_variant(sa.FLOAT(), "postgresql"),
            nullable=True,
            comment="The delivered guider exposure time for a single stamp.",
        ),
        schema="cdb_lsstcam",
    )
    op.add_column(
        "visit1_quicklook",
        sa.Column(
            "guider_n_stamps_expected",
            sa.INTEGER().with_variant(mysql.INTEGER(), "mysql").with_variant(sa.INTEGER(), "postgresql"),
            nullable=True,
            comment="Number of expected guider stamps.",
        ),
        schema="cdb_lsstcam",
    )
    op.add_column(
        "visit1_quicklook",
        sa.Column(
            "guider_n_stamps_delivered",
            sa.INTEGER().with_variant(mysql.INTEGER(), "mysql").with_variant(sa.INTEGER(), "postgresql"),
            nullable=True,
            comment="Number of delivered guider stamps.",
        ),
        schema="cdb_lsstcam",
    )
    op.add_column(
        "visit1_quicklook",
        sa.Column(
            "guider_roi_cols",
            sa.FLOAT().with_variant(mysql.FLOAT(), "mysql").with_variant(sa.FLOAT(), "postgresql"),
            nullable=True,
            comment="Number of columns in the guider ROI, in pixels.",
        ),
        schema="cdb_lsstcam",
    )
    op.add_column(
        "visit1_quicklook",
        sa.Column(
            "guider_roi_rows",
            sa.FLOAT().with_variant(mysql.FLOAT(), "mysql").with_variant(sa.FLOAT(), "postgresql"),
            nullable=True,
            comment="Number of rows in the guider ROI, in pixels.",
        ),
        schema="cdb_lsstcam",
    )
    op.add_column(
        "visit1_quicklook",
        sa.Column(
            "guider_psf_fwhm",
            sa.FLOAT().with_variant(mysql.FLOAT(), "mysql").with_variant(sa.FLOAT(), "postgresql"),
            nullable=True,
            comment="Mean PSF FWHM for all measurements over the exposure.",
        ),
        schema="cdb_lsstcam",
    )
    op.alter_column(
        "visit1_quicklook",
        "guider_exp_time",
        existing_type=sa.DOUBLE_PRECISION(precision=53),
        comment="Total guider exposure time across all stamps.",
        existing_comment="Guider exposure time.",
        existing_nullable=True,
        schema="cdb_lsstcam",
    )
    op.drop_column("visit1_quicklook", "guider_roi_size", schema="cdb_lsstcam")
    op.drop_column("visit1_quicklook", "guider_t_mean", schema="cdb_lsstcam")
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column(
        "visit1_quicklook",
        sa.Column(
            "guider_t_mean",
            sa.DOUBLE_PRECISION(precision=53),
            autoincrement=False,
            nullable=True,
            comment="Mean second moment T for all measurements over the exposure.",
        ),
        schema="cdb_lsstcam",
    )
    op.add_column(
        "visit1_quicklook",
        sa.Column(
            "guider_roi_size",
            sa.DOUBLE_PRECISION(precision=53),
            autoincrement=False,
            nullable=True,
            comment="Length of guider ROI side in pixels.",
        ),
        schema="cdb_lsstcam",
    )
    op.alter_column(
        "visit1_quicklook",
        "guider_exp_time",
        existing_type=sa.DOUBLE_PRECISION(precision=53),
        comment="Guider exposure time.",
        existing_comment="Total guider exposure time across all stamps.",
        existing_nullable=True,
        schema="cdb_lsstcam",
    )
    op.drop_column("visit1_quicklook", "guider_psf_fwhm", schema="cdb_lsstcam")
    op.drop_column("visit1_quicklook", "guider_roi_rows", schema="cdb_lsstcam")
    op.drop_column("visit1_quicklook", "guider_roi_cols", schema="cdb_lsstcam")
    op.drop_column("visit1_quicklook", "guider_n_stamps_delivered", schema="cdb_lsstcam")
    op.drop_column("visit1_quicklook", "guider_n_stamps_expected", schema="cdb_lsstcam")
    op.drop_column("visit1_quicklook", "guider_stamp_exp_time", schema="cdb_lsstcam")
    # ### end Alembic commands ###
